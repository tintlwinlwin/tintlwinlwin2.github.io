<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Thalesgroup">
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>FCM - TDI SDK v2.0.0</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/hybrid.min.css">

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/groovy.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/kotlin.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/java.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/json.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="index.html">TDI SDK v2.0.0</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="index.html" class="nav-link">Overview</a>
                            </li>
                            <li class="navitem">
                                <a href="get_started_android.html" class="nav-link">Get Started</a>
                            </li>
                            <li class="navitem">
                                <a href="api.html" class="nav-link">API</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Capture Tools <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="capture_tools_main.html" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="capture_tools_id_document_capture.html" class="dropdown-item">ID Document Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_face_liveness_capture.html" class="dropdown-item">Selfie Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_native_id_document_capture.html" class="dropdown-item">Native ID Document Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_contract_signature_capture.html" class="dropdown-item">Contract / Signature Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_contract_esignature_capture.html" class="dropdown-item">Web Contract / Signature Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_non_id_document_capture.html" class="dropdown-item">Non-ID Document Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_nfc_mrz_document_capture.html" class="dropdown-item">NFC / MRZ Document Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_voice_capture.html" class="dropdown-item">Voice Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_fingerprint_capture.html" class="dropdown-item">FingerPrint Capture</a>
</li>
                                    
<li>
    <a href="capture_tools_editable_response_capture.html" class="dropdown-item">Editable Response Update</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="profile_api.html" class="nav-link">Profile API</a>
                            </li>
                            <li class="navitem">
                                <a href="error_guide.html" class="nav-link">Error Guide</a>
                            </li>
                            <li class="navitem">
                                <a href="security.html" class="nav-link">Security</a>
                            </li>
                            <li class="navitem active">
                                <a href="fcm_integration.html" class="nav-link">FCM</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="security.html" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#fcm-integration" class="nav-link">FCM integration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#1-application-doesnt-implement-firebase" class="nav-link">1. Application doesn't implement Firebase</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#2-application-already-implements-firebase" class="nav-link">2. Application already implements Firebase</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="fcm-integration">FCM integration</h1>
<p></br></p>
<h2 id="introduction">Introduction</h2>
<hr />
<p>TDI SDK needs to run FCM services to send push messages to the SDK to trigger some actions.</p>
<p>For this an application has to run FirebaseMessagingService that listening the reception of push notification, but only one instance of this service can be created on one application. Two use cases can happen:</p>
<ol>
<li>Application doesn't implement Firebase</li>
<li>Application already implement Firebase</li>
</ol>
<p>On both case a Thales Firebase account has to be created. For this thank you to contact you Thales entry points for the project you develop, and give your applicationId. This account will provide us a Sender Id that we need to integrate in the SDK.</p>
<p></br></p>
<h3 id="1-application-doesnt-implement-firebase">1. Application doesn't implement Firebase</h3>
<p>To integrate Firebase we need to add some dependencies to the project.</p>
<p>Project build.gradle</p>
<p> <pre><code class=xml>dependencies {
    ...
    classpath 'com.google.gms:google-services:4.3.5'
}
</code></pre></p>
<p>Application build.gradle</p>
<p> <pre><code class=xml>dependencies {
    ...
    implementation 'com.google.firebase:firebase-messaging:17.3.0' 
    implementation 'com.google.firebase:firebase-core:16.0.3'
}
apply plugin: 'com.google.gms.google-services'

</code></pre></p>
<p>Now if you build the application, the compiler will fail asking for google-services.json file to be added at the root of the application like next to your Application build.gradle file:</p>
<p><img alt="google_services" src="img/google_services.png" /></p>
<p>New application will have new file. From the previous Project account creation in Firebase (see Introduction), we will be able to provide you the google-services file link to your App.</p>
<p>Once the file is provided, you should be able to compile your Application and everything is done. Firebase will register automatically to the Firebase/TDI Server and TDI server will be able to send push notification to the Application through FCM.</p>
<p></br></p>
<details>
<summary>[Optional] If not default Thales FCM server</summary>
</br>
<p>
On your application, once you have your TdiMobileSdk instance, you can set the Sender ID. Please ask it if you did't received with the google-services.json file.
</p>
<p>
Sender ID allow us to be sure the message is send by our FCM account and not another to inject message.
</p>




 <pre><code class=kotlin>val tdiMobileSdk = TdiMobileSdk.getInstance()
tdiMobileSdk.setFCMSenderID(&quot;MySenderID&quot;)
</code></pre>

</details>

<p></br></p>
<h3 id="2-application-already-implements-firebase">2. Application already implements Firebase</h3>
<p>Since Firebase is already implemented, the FirebaseMessagingService implemented in SDK won't be activate. Instead the one created by the Application will. In order to received the push notification we need two steps, one internal and one external.</p>
<div class="admonition note">
<p class="admonition-title"><strong>Internal</strong></p>
<p>From the previous Project account creation in Firebase (see Introduction), we will be able to customize the SDK with the correct Sender Id link to the Application</p>
</div>
<div class="admonition note">
<p class="admonition-title"><strong>External</strong></p>
<p>We have to request some code implementation. Since the Application already implement Firebase,  the project should contain a class extending FirebaseMessagingService, to receive push notification. This class is containing a method onMessageReceived(), that's here we need to call TDI API to receive TDI push notification like the following code.</p>
</div>
<p> <pre><code class=kotlin>class ApplicationFirebaseMessageService: FirebaseMessagingService() {

    override fun onMessageReceived(remoteMessage: RemoteMessage?) {
        if(remoteMessage.from == &quot;Application Sender ID&quot;){
            ...
        }else{ //I transfer message to TDI SDK
            TdiService.onMessageReceived(remoteMessage)
        }
    }
}
</code></pre></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>All Rights Reserved, this document is provided in confidence. No part of it may be reproduced or communicated externally without the written permission of Thalesgroup. The information in this document is confidential and may be legally privileged. Access to its contents by anyone else is unauthorized; any disclosure, copying, distribution or any action taken or omitted to be taken in reliance on it, is prohibited and may be unlawful.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
